<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–Ω–±–∞–Ω: –ö—Å–µ–Ω–∏—è & –ö–ª–∞—É</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; padding: 20px; min-height: 100vh; }
        h1 { text-align: center; margin-bottom: 30px; color: #333; font-size: 24px; }
        .board { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 20px; }
        .column { background: #ebecf0; border-radius: 12px; width: 280px; min-width: 280px; padding: 15px; display: flex; flex-direction: column; max-height: calc(100vh - 150px); }
        .column-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #ddd; }
        .column-title { font-weight: 600; font-size: 14px; color: #333; }
        .column-count { background: #fff; padding: 2px 8px; border-radius: 12px; font-size: 12px; color: #666; }
        .tasks { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; min-height: 100px; }
        .task { background: #fff; padding: 12px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); cursor: grab; transition: transform 0.2s, box-shadow 0.2s; }
        .task:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .task.dragging { opacity: 0.5; cursor: grabbing; }
        .task-title { font-size: 14px; color: #333; margin-bottom: 8px; line-height: 1.4; word-wrap: break-word; }
        .task-meta { display: flex; gap: 6px; flex-wrap: wrap; }
        .tag { font-size: 10px; padding: 3px 8px; border-radius: 12px; font-weight: 500; }
        .tag-high { background: #ffebee; color: #c62828; }
        .tag-medium { background: #fff3e0; color: #ef6c00; }
        .tag-low { background: #e8f5e9; color: #2e7d32; }
        .tag-automation { background: #e1f5fe; color: #0277bd; }
        .tag-research { background: #f3e5f5; color: #7b1fa2; }
        .tag-integration { background: #e0f2f1; color: #00695c; }
        .tag-content { background: #fff8e1; color: #f57f17; }
        .add-task { margin-top: 10px; padding: 10px; background: transparent; border: 2px dashed #ccc; border-radius: 8px; color: #666; cursor: pointer; font-size: 14px; transition: all 0.2s; }
        .add-task:hover { border-color: #999; color: #333; background: rgba(0,0,0,0.02); }
        .column.drag-over { background: #d4edda; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal.active { display: flex; }
        .modal-content { background: #fff; padding: 25px; border-radius: 12px; width: 90%; max-width: 400px; max-height: 90vh; overflow-y: auto; }
        .modal-title { font-size: 18px; margin-bottom: 15px; color: #333; }
        .modal input, .modal select, .modal textarea { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; font-family: inherit; }
        .modal textarea { min-height: 80px; resize: vertical; }
        .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 10px; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-primary { background: #1976d2; color: #fff; }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .delete-btn { float: right; color: #999; cursor: pointer; font-size: 18px; line-height: 1; padding: 0 4px; margin: -4px -4px 0 0; }
        .delete-btn:hover { color: #c62828; }
        .column-ideas { border-top: 4px solid #7c4dff; }
        .column-todo { border-top: 4px solid #9e9e9e; }
        .column-progress { border-top: 4px solid #1976d2; }
        .column-review { border-top: 4px solid #f57c00; }
        .column-done { border-top: 4px solid #388e3c; }
        @media (max-width: 768px) {
            body { padding: 10px; }
            h1 { font-size: 20px; margin-bottom: 20px; }
            .column { width: 260px; min-width: 260px; padding: 12px; }
            .board { gap: 10px; }
        }
    </style>
</head>
<body>
    <h1>üìã –ö–∞–Ω–±–∞–Ω: –ö—Å–µ–Ω–∏—è & –ö–ª–∞—É</h1>
    <div class="board">
        <div class="column column-ideas" data-column="ideas">
            <div class="column-header">
                <span class="column-title">üí° –ò–¥–µ–∏ / –ù–∞ –ø–æ—Ç–æ–º</span>
                <span class="column-count">0</span>
            </div>
            <div class="tasks"></div>
            <button class="add-task" onclick="openModal('ideas')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div class="column column-todo" data-column="todo">
            <div class="column-header">
                <span class="column-title">üìã –í –ø–ª–∞–Ω–µ</span>
                <span class="column-count">0</span>
            </div>
            <div class="tasks"></div>
            <button class="add-task" onclick="openModal('todo')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div class="column column-progress" data-column="progress">
            <div class="column-header">
                <span class="column-title">üîß –ö–ª–∞—É –¥–µ–ª–∞–µ—Ç</span>
                <span class="column-count">0</span>
            </div>
            <div class="tasks"></div>
            <button class="add-task" onclick="openModal('progress')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div class="column column-review" data-column="review">
            <div class="column-header">
                <span class="column-title">üëÄ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</span>
                <span class="column-count">0</span>
            </div>
            <div class="tasks"></div>
            <button class="add-task" onclick="openModal('review')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div class="column column-done" data-column="done">
            <div class="column-header">
                <span class="column-title">‚úÖ –ì–æ—Ç–æ–≤–æ</span>
                <span class="column-count">0</span>
            </div>
            <div class="tasks"></div>
            <button class="add-task" onclick="openModal('done')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
    </div>
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 class="modal-title">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h3>
            <input type="text" id="taskTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏">
            <select id="taskPriority">
                <option value="high">üî¥ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</option>
                <option value="medium" selected>üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</option>
                <option value="low">üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</option>
            </select>
            <select id="taskType">
                <option value="automation">ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</option>
                <option value="research">üîç –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</option>
                <option value="integration">üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è</option>
                <option value="content">üìù –ö–æ–Ω—Ç–µ–Ω—Ç</option>
                <option value="task" selected>üìã –î—Ä—É–≥–æ–µ</option>
            </select>
            <textarea id="taskDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="addTask()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>
    <script>
        let currentColumn = 'todo';
        let draggedTask = null;
        let taskIdCounter = Date.now();
        
        // –ù–∞—á–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
        const defaultTasks = [
            { id: 'task-1', title: '–°–æ–∑–¥–∞—Ç—å –∫–∞–Ω–±–∞–Ω-–¥–æ—Å–∫—É –≤ Telegram Mini App', priority: 'high', type: 'automation', desc: '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GitHub Pages', column: 'done' },
            { id: 'task-2', title: '–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è Exchange', priority: 'high', type: 'integration', desc: 'Python —Å–∫—Ä–∏–ø—Ç –¥–ª—è EWS', column: 'done' },
            { id: 'task-3', title: '–£—Ç—Ä–µ–Ω–Ω–∏–π –¥–∞–π–¥–∂–µ—Å—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—è (cron)', priority: 'medium', type: 'automation', desc: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram', column: 'done' },
            { id: 'task-4', title: '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Bitrix24 –¥–ª—è –∑–∞–¥–∞—á', priority: 'medium', type: 'integration', desc: '–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á –∏–∑ API', column: 'ideas' }
        ];
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á –∏–∑ localStorage –∏–ª–∏ –Ω–∞—á–∞–ª—å–Ω—ã—Ö
        function loadTasks() {
            const saved = localStorage.getItem('kanban-tasks');
            if (saved) {
                try {
                    const tasks = JSON.parse(saved);
                    tasks.forEach(task => {
                        if (task && task.id) {
                            taskIdCounter = Math.max(taskIdCounter, parseInt(task.id.split('-')[1]) || 0);
                            createTaskElement(task);
                        }
                    });
                } catch(e) { console.error('Error loading tasks:', e); }
            } else {
                // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ - –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
                defaultTasks.forEach(task => createTaskElement(task));
                saveTasks();
            }
            updateCounts();
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á
        function saveTasks() {
            const tasks = [];
            document.querySelectorAll('.task').forEach(taskEl => {
                tasks.push({
                    id: taskEl.dataset.id,
                    title: taskEl.querySelector('.task-title').textContent,
                    priority: taskEl.dataset.priority,
                    type: taskEl.dataset.type,
                    desc: taskEl.dataset.desc || '',
                    column: taskEl.closest('.column').dataset.column
                });
            });
            localStorage.setItem('kanban-tasks', JSON.stringify(tasks));
        }
        
        function openModal(column) {
            currentColumn = column;
            document.getElementById('modal').classList.add('active');
            document.getElementById('taskTitle').focus();
        }
        
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDesc').value = '';
        }
        
        function addTask() {
            const title = document.getElementById('taskTitle').value.trim();
            if (!title) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏');
                return;
            }
            
            const task = {
                id: 'task-' + (++taskIdCounter),
                title: title,
                priority: document.getElementById('taskPriority').value,
                type: document.getElementById('taskType').value,
                desc: document.getElementById('taskDesc').value.trim(),
                column: currentColumn
            };
            
            createTaskElement(task);
            saveTasks();
            updateCounts();
            closeModal();
        }
        
        function createTaskElement(task) {
            const taskEl = document.createElement('div');
            taskEl.className = 'task';
            taskEl.draggable = true;
            taskEl.dataset.id = task.id;
            taskEl.dataset.priority = task.priority;
            taskEl.dataset.type = task.type;
            taskEl.dataset.desc = task.desc || '';
            
            const priorityClass = 'tag-' + task.priority;
            const typeClasses = {
                'automation': 'tag-automation',
                'research': 'tag-research', 
                'integration': 'tag-integration',
                'content': 'tag-content',
                'task': ''
            };
            const typeLabels = {
                'automation': '–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è',
                'research': '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ',
                'integration': '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è', 
                'content': '–ö–æ–Ω—Ç–µ–Ω—Ç',
                'task': ''
            };
            const typeClass = typeClasses[task.type] || '';
            const typeLabel = typeLabels[task.type] || '';
            
            taskEl.innerHTML = `
                <span class="delete-btn" onclick="deleteTask(this)">&times;</span>
                <div class="task-title">${escapeHtml(task.title)}</div>
                <div class="task-meta">
                    <span class="tag ${priorityClass}">${getPriorityLabel(task.priority)}</span>
                    ${typeLabel ? `<span class="tag ${typeClass}">${typeLabel}</span>` : ''}
                </div>
            `;
            
            // Drag events
            taskEl.addEventListener('dragstart', (e) => {
                draggedTask = taskEl;
                taskEl.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
            });
            
            taskEl.addEventListener('dragend', () => {
                draggedTask = null;
                taskEl.classList.remove('dragging');
                document.querySelectorAll('.column').forEach(col => {
                    col.classList.remove('drag-over');
                });
                saveTasks();
                updateCounts();
            });
            
            const column = document.querySelector(`[data-column="${task.column}"]`);
            if (column) {
                column.querySelector('.tasks').appendChild(taskEl);
            }
        }
        
        function deleteTask(btn) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?')) {
                btn.closest('.task').remove();
                saveTasks();
                updateCounts();
            }
        }
        
        function updateCounts() {
            document.querySelectorAll('.column').forEach(column => {
                const count = column.querySelectorAll('.task').length;
                column.querySelector('.column-count').textContent = count;
            });
        }
        
        function getPriorityLabel(priority) {
            const labels = { high: '–í—ã—Å–æ–∫–∏–π', medium: '–°—Ä–µ–¥–Ω–∏–π', low: '–ù–∏–∑–∫–∏–π' };
            return labels[priority] || priority;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Drop zones
        document.querySelectorAll('.column').forEach(column => {
            column.addEventListener('dragover', (e) => {
                e.preventDefault();
                column.classList.add('drag-over');
            });
            
            column.addEventListener('dragleave', () => {
                column.classList.remove('drag-over');
            });
            
            column.addEventListener('drop', (e) => {
                e.preventDefault();
                column.classList.remove('drag-over');
                if (draggedTask) {
                    column.querySelector('.tasks').appendChild(draggedTask);
                    saveTasks();
                    updateCounts();
                }
            });
        });
        
        // Enter –≤ –º–æ–¥–∞–ª–∫–µ
        document.getElementById('taskTitle').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addTask();
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') closeModal();
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadTasks();
    </script>
</body>
</html>
