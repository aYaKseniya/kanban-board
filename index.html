<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–Ω–±–∞–Ω: –ö—Å–µ–Ω–∏—è & –ö–ª–∞—É</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; padding: 20px; min-height: 100vh; }
        h1 { text-align: center; margin-bottom: 30px; color: #333; font-size: 24px; }
        .board { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 20px; }
        .column { background: #ebecf0; border-radius: 12px; width: 280px; min-width: 280px; padding: 15px; display: flex; flex-direction: column; max-height: calc(100vh - 150px); }
        .column-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #ddd; }
        .column-title { font-weight: 600; font-size: 14px; color: #333; }
        .column-count { background: #fff; padding: 2px 8px; border-radius: 12px; font-size: 12px; color: #666; }
        .tasks { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; min-height: 100px; }
        .task { background: #fff; padding: 12px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); cursor: grab; transition: transform 0.2s, box-shadow 0.2s; }
        .task:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .task.dragging { opacity: 0.5; cursor: grabbing; }
        .task-title { font-size: 14px; color: #333; margin-bottom: 8px; line-height: 1.4; word-wrap: break-word; }
        .task-meta { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 6px; }
        .task-dates { font-size: 10px; color: #999; margin-top: 6px; border-top: 1px solid #eee; padding-top: 6px; }
        .tag { font-size: 10px; padding: 3px 8px; border-radius: 12px; font-weight: 500; }
        .tag-high { background: #ffebee; color: #c62828; }
        .tag-medium { background: #fff3e0; color: #ef6c00; }
        .tag-low { background: #e8f5e9; color: #2e7d32; }
        .tag-automation { background: #e1f5fe; color: #0277bd; }
        .tag-research { background: #f3e5f5; color: #7b1fa2; }
        .tag-integration { background: #e0f2f1; color: #00695c; }
        .tag-content { background: #fff8e1; color: #f57f17; }
        .add-task { margin-top: 10px; padding: 10px; background: transparent; border: 2px dashed #ccc; border-radius: 8px; color: #666; cursor: pointer; font-size: 14px; transition: all 0.2s; }
        .add-task:hover { border-color: #999; color: #333; background: rgba(0,0,0,0.02); }
        .column.drag-over { background: #d4edda; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal.active { display: flex; }
        .modal-content { background: #fff; padding: 25px; border-radius: 12px; width: 90%; max-width: 400px; max-height: 90vh; overflow-y: auto; }
        .modal-title { font-size: 18px; margin-bottom: 15px; color: #333; }
        .modal input, .modal select, .modal textarea { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; font-family: inherit; }
        .modal textarea { min-height: 80px; resize: vertical; }
        .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 10px; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-primary { background: #1976d2; color: #fff; }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .delete-btn { float: right; color: #999; cursor: pointer; font-size: 18px; line-height: 1; padding: 0 4px; margin: -4px -4px 0 0; }
        .delete-btn:hover { color: #c62828; }
        .history-btn { font-size: 10px; color: #1976d2; cursor: pointer; margin-top: 4px; }
        .history-btn:hover { text-decoration: underline; }
        .column-ideas { border-top: 4px solid #7c4dff; }
        .column-todo { border-top: 4px solid #9e9e9e; }
        .column-progress { border-top: 4px solid #1976d2; }
        .column-review { border-top: 4px solid #f57c00; }
        .column-done { border-top: 4px solid #388e3c; }
        .sync-status { position: fixed; top: 10px; right: 10px; padding: 8px 12px; border-radius: 20px; font-size: 12px; }
        .sync-status.syncing { background: #fff3e0; color: #ef6c00; }
        .sync-status.synced { background: #e8f5e9; color: #2e7d32; }
        .sync-status.error { background: #ffebee; color: #c62828; }
        @media (max-width: 768px) {
            body { padding: 10px; }
            h1 { font-size: 20px; margin-bottom: 20px; }
            .column { width: 260px; min-width: 260px; padding: 12px; }
            .board { gap: 10px; }
        }
    </style>
</head>
<body>
    <div class="sync-status" id="syncStatus">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <h1>üìã –ö–∞–Ω–±–∞–Ω: –ö—Å–µ–Ω–∏—è & –ö–ª–∞—É</h1>
    <div class="board">
        <div class="column column-ideas" data-column="ideas">
            <div class="column-header">
                <span class="column-title">üí° –ò–¥–µ–∏ / –ù–∞ –ø–æ—Ç–æ–º</span>
                <span class="column-count">0</span>
            </div>
            <div class="tasks"></div>
            <button class="add-task" onclick="openModal('ideas')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div class="column column-todo" data-column="todo">
            <div class="column-header">
                <span class="column-title">üìã –í –ø–ª–∞–Ω–µ</span>
                <span class="column-count">0</span>
            </div>
            <div class="tasks"></div>
            <button class="add-task" onclick="openModal('todo')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div class="column column-progress" data-column="progress">
            <div class="column-header">
                <span class="column-title">üîß –ö–ª–∞—É –¥–µ–ª–∞–µ—Ç</span>
                <span class="column-count">0</span>
            </div>
            <div class="tasks"></div>
            <button class="add-task" onclick="openModal('progress')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div class="column column-review" data-column="review">
            <div class="column-header">
                <span class="column-title">üëÄ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</span>
                <span class="column-count">0</span>
            </div>
            <div class="tasks"></div>
            <button class="add-task" onclick="openModal('review')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div class="column column-done" data-column="done">
            <div class="column-header">
                <span class="column-title">‚úÖ –ì–æ—Ç–æ–≤–æ</span>
                <span class="column-count">0</span>
            </div>
            <div class="tasks"></div>
            <button class="add-task" onclick="openModal('done')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 class="modal-title">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h3>
            <input type="text" id="taskTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏">
            <select id="taskPriority">
                <option value="high">üî¥ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</option>
                <option value="medium" selected>üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</option>
                <option value="low">üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</option>
            </select>
            <select id="taskType">
                <option value="automation">ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</option>
                <option value="research">üîç –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</option>
                <option value="integration">üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è</option>
                <option value="content">üìù –ö–æ–Ω—Ç–µ–Ω—Ç</option>
                <option value="task" selected>üìã –î—Ä—É–≥–æ–µ</option>
            </select>
            <textarea id="taskDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="addTask()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–∏—á–∏–Ω—ã –ø–µ—Ä–µ–Ω–æ—Å–∞ -->
    <div class="modal" id="moveModal">
        <div class="modal-content">
            <h3 class="modal-title">–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏</h3>
            <p id="moveTaskTitle" style="margin-bottom: 12px; font-weight: 500;"></p>
            <p style="margin-bottom: 12px; color: #666;">–ò–∑: <span id="moveFromCol"></span> ‚Üí –í: <span id="moveToCol"></span></p>
            <textarea id="moveReason" placeholder="–ü—Ä–∏—á–∏–Ω–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="min-height: 60px;"></textarea>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeMoveModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="confirmMove()">–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // GitHub API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        // –¢–æ–∫–µ–Ω –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –∑–¥–µ—Å—å –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
        const GITHUB_TOKEN = localStorage.getItem('github_token') || prompt('–í–≤–µ–¥–∏—Ç–µ GitHub —Ç–æ–∫–µ–Ω –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:');
        if (GITHUB_TOKEN) localStorage.setItem('github_token', GITHUB_TOKEN);
        const REPO_OWNER = 'aYaKseniya';
        const REPO_NAME = 'kanban-board';
        
        let currentColumn = 'todo';
        let draggedTask = null;
        let pendingMove = null;
        let tasks = [];
        
        // –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        function setSyncStatus(status, text) {
            const el = document.getElementById('syncStatus');
            el.className = 'sync-status ' + status;
            el.textContent = text;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á –∏–∑ GitHub Issues
        async function loadTasks() {
            setSyncStatus('syncing', '‚è≥ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...');
            try {
                const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/issues?state=all&per_page=100`, {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) throw new Error('Failed to fetch issues');
                
                const issues = await response.json();
                tasks = issues.map(issue => ({
                    id: 'task-' + issue.number,
                    title: issue.title,
                    body: issue.body || '',
                    column: getColumnFromLabels(issue.labels),
                    priority: getPriorityFromBody(issue.body),
                    type: getTypeFromBody(issue.body),
                    created: issue.created_at.split('T')[0],
                    completed: issue.closed_at ? issue.closed_at.split('T')[0] : null,
                    number: issue.number,
                    history: []
                }));
                
                renderTasks();
                setSyncStatus('synced', '‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
            } catch (error) {
                console.error('Error loading tasks:', error);
                setSyncStatus('error', '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                // Fallback –∫ localStorage
                loadFromLocalStorage();
            }
        }
        
        function getColumnFromLabels(labels) {
            const columnLabels = ['ideas', 'todo', 'progress', 'review', 'done'];
            for (const label of labels) {
                if (columnLabels.includes(label.name)) return label.name;
            }
            return 'todo';
        }
        
        function getPriorityFromBody(body) {
            if (!body) return 'medium';
            if (body.includes('–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: high')) return 'high';
            if (body.includes('–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: low')) return 'low';
            return 'medium';
        }
        
        function getTypeFromBody(body) {
            if (!body) return 'task';
            const match = body.match(/–¢–∏–ø: (\w+)/);
            return match ? match[1] : 'task';
        }
        
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('kanban-tasks');
            if (saved) {
                tasks = JSON.parse(saved);
                renderTasks();
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (GitHub Issue)
        async function createTaskOnGitHub(task) {
            setSyncStatus('syncing', '‚è≥ –°–æ–∑–¥–∞–Ω–∏–µ...');
            try {
                const body = `**–û–ø–∏—Å–∞–Ω–∏–µ:** ${task.desc || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ${task.priority}
**–¢–∏–ø:** ${task.type}
**–°–æ–∑–¥–∞–Ω–æ:** ${task.created}`;
                
                const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/issues`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: task.title,
                        body: body,
                        labels: [task.column, task.priority, task.type]
                    })
                });
                
                if (!response.ok) throw new Error('Failed to create issue');
                
                const issue = await response.json();
                setSyncStatus('synced', '‚úÖ –°–æ–∑–¥–∞–Ω–æ');
                return issue.number;
            } catch (error) {
                console.error('Error creating task:', error);
                setSyncStatus('error', '‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è');
                return null;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
        async function updateTaskOnGitHub(taskNumber, updates) {
            setSyncStatus('syncing', '‚É£ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...');
            try {
                const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/issues/${taskNumber}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updates)
                });
                
                if (!response.ok) throw new Error('Failed to update issue');
                
                setSyncStatus('synced', '‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ');
                return true;
            } catch (error) {
                console.error('Error updating task:', error);
                setSyncStatus('error', '‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
                return false;
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (–∏—Å—Ç–æ—Ä–∏—è)
        async function addCommentToTask(taskNumber, comment) {
            try {
                await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/issues/${taskNumber}/comments`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ body: comment })
                });
            } catch (error) {
                console.error('Error adding comment:', error);
            }
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á
        function renderTasks() {
            document.querySelectorAll('.tasks').forEach(el => el.innerHTML = '');
            
            tasks.forEach(task => {
                createTaskElement(task);
            });
            
            updateCounts();
            saveToLocalStorage();
        }
        
        function createTaskElement(task) {
            const taskEl = document.createElement('div');
            taskEl.className = 'task';
            taskEl.draggable = true;
            taskEl.dataset.id = task.id;
            taskEl.dataset.number = task.number || '';
            
            const priorityClass = 'tag-' + (task.priority || 'medium');
            const typeClasses = {
                'automation': 'tag-automation',
                'research': 'tag-research',
                'integration': 'tag-integration',
                'content': 'tag-content',
                'task': ''
            };
            const typeLabels = {
                'automation': '–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è',
                'research': '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ',
                'integration': '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è',
                'content': '–ö–æ–Ω—Ç–µ–Ω—Ç',
                'task': ''
            };
            const typeClass = typeClasses[task.type] || '';
            const typeLabel = typeLabels[task.type] || '';
            
            const completedDate = task.completed ? `<br>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${task.completed}` : '';
            
            taskEl.innerHTML = `
                <span class="delete-btn" onclick="deleteTask('${task.id}')">&times;</span>
                <div class="task-title">${escapeHtml(task.title)}</div>
                <div class="task-meta">
                    <span class="tag ${priorityClass}">${getPriorityLabel(task.priority)}</span>
                    ${typeLabel ? `<span class="tag ${typeClass}">${typeLabel}</span>` : ''}
                </div>
                <div class="task-dates">
                    üìÖ –°–æ–∑–¥–∞–Ω–æ: ${task.created}${completedDate}
                </div>
            `;
            
            // Drag events
            taskEl.addEventListener('dragstart', (e) => {
                draggedTask = task;
                taskEl.classList.add('dragging');
            });
            
            taskEl.addEventListener('dragend', () => {
                taskEl.classList.remove('dragging');
                document.querySelectorAll('.column').forEach(col => {
                    col.classList.remove('drag-over');
                });
            });
            
            const column = document.querySelector(`[data-column="${task.column}"]`);
            if (column) {
                column.querySelector('.tasks').appendChild(taskEl);
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function getPriorityLabel(priority) {
            const labels = { high: '–í—ã—Å–æ–∫–∏–π', medium: '–°—Ä–µ–¥–Ω–∏–π', low: '–ù–∏–∑–∫–∏–π' };
            return labels[priority] || priority;
        }
        
        function updateCounts() {
            document.querySelectorAll('.column').forEach(column => {
                const count = column.querySelectorAll('.task').length;
                column.querySelector('.column-count').textContent = count;
            });
        }
        
        function saveToLocalStorage() {
            localStorage.setItem('kanban-tasks', JSON.stringify(tasks));
        }
        
        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function openModal(column) {
            currentColumn = column;
            document.getElementById('modal').classList.add('active');
            document.getElementById('taskTitle').focus();
        }
        
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDesc').value = '';
        }
        
        async function addTask() {
            const title = document.getElementById('taskTitle').value.trim();
            if (!title) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏');
                return;
            }
            
            const task = {
                id: 'task-' + Date.now(),
                title: title,
                priority: document.getElementById('taskPriority').value,
                type: document.getElementById('taskType').value,
                desc: document.getElementById('taskDesc').value.trim(),
                column: currentColumn,
                created: new Date().toISOString().split('T')[0],
                completed: currentColumn === 'done' ? new Date().toISOString().split('T')[0] : null,
                history: []
            };
            
            // –°–æ–∑–¥–∞—ë–º –Ω–∞ GitHub
            const issueNumber = await createTaskOnGitHub(task);
            if (issueNumber) {
                task.number = issueNumber;
            }
            
            tasks.push(task);
            renderTasks();
            closeModal();
        }
        
        // Drag & Drop —Å –∑–∞–ø—Ä–æ—Å–æ–º –ø—Ä–∏—á–∏–Ω—ã
        document.querySelectorAll('.column').forEach(column => {
            column.addEventListener('dragover', (e) => {
                e.preventDefault();
                column.classList.add('drag-over');
            });
            
            column.addEventListener('dragleave', () => {
                column.classList.remove('drag-over');
            });
            
            column.addEventListener('drop', (e) => {
                e.preventDefault();
                column.classList.remove('drag-over');
                
                if (draggedTask) {
                    const newColumn = column.dataset.column;
                    if (draggedTask.column !== newColumn) {
                        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –¥–ª—è –ø—Ä–∏—á–∏–Ω—ã
                        pendingMove = {
                            task: draggedTask,
                            from: draggedTask.column,
                            to: newColumn
                        };
                        openMoveModal(draggedTask, draggedTask.column, newColumn);
                    }
                }
            });
        });
        
        function openMoveModal(task, from, to) {
            const colNames = {
                ideas: 'üí° –ò–¥–µ–∏',
                todo: 'üìã –í –ø–ª–∞–Ω–µ',
                progress: 'üîß –í —Ä–∞–±–æ—Ç–µ',
                review: 'üëÄ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ',
                done: '‚úÖ –ì–æ—Ç–æ–≤–æ'
            };
            
            document.getElementById('moveTaskTitle').textContent = task.title;
            document.getElementById('moveFromCol').textContent = colNames[from];
            document.getElementById('moveToCol').textContent = colNames[to];
            document.getElementById('moveReason').value = '';
            document.getElementById('moveModal').classList.add('active');
        }
        
        function closeMoveModal() {
            document.getElementById('moveModal').classList.remove('active');
            pendingMove = null;
        }
        
        async function confirmMove() {
            if (!pendingMove) return;
            
            const reason = document.getElementById('moveReason').value.trim();
            const { task, from, to } = pendingMove;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–¥–∞—á—É
            task.column = to;
            if (to === 'done' && !task.completed) {
                task.completed = new Date().toISOString().split('T')[0];
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            const moveRecord = {
                from: from,
                to: to,
                date: new Date().toISOString().split('T')[0],
                reason: reason || '–ë–µ–∑ –ø—Ä–∏—á–∏–Ω—ã'
            };
            task.history.push(moveRecord);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞ GitHub
            if (task.number) {
                const body = `**–û–ø–∏—Å–∞–Ω–∏–µ:** ${task.desc || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ${task.priority}
**–¢–∏–ø:** ${task.type}
**–°–æ–∑–¥–∞–Ω–æ:** ${task.created}

**–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π:**
${task.history.map(h => `- ${h.date}: ${h.from} ‚Üí ${h.to}${h.reason ? ' (' + h.reason + ')' : ''}`).join('\n')}`;
                
                await updateTaskOnGitHub(task.number, {
                    labels: [to, task.priority, task.type],
                    body: body,
                    state: to === 'done' ? 'closed' : 'open'
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏
                const comment = `üì¶ –ü–µ—Ä–µ–º–µ—â–µ–Ω–æ: ${from} ‚Üí ${to}\nüìÖ –î–∞—Ç–∞: ${moveRecord.date}${reason ? '\nüí¨ –ü—Ä–∏—á–∏–Ω–∞: ' + reason : ''}`;
                await addCommentToTask(task.number, comment);
            }
            
            renderTasks();
            closeMoveModal();
        }
        
        async function deleteTask(taskId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?')) return;
            
            const task = tasks.find(t => t.id === taskId);
            if (task && task.number) {
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º issue –Ω–∞ GitHub
                await updateTaskOnGitHub(task.number, { state: 'closed' });
            }
            
            tasks = tasks.filter(t => t.id !== taskId);
            renderTasks();
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') closeModal();
        });
        
        document.getElementById('moveModal').addEventListener('click', (e) => {
            if (e.target.id === 'moveModal') closeMoveModal();
        });
        
        // Enter –≤ –ø–æ–ª—è—Ö
        document.getElementById('taskTitle').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addTask();
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadTasks();
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(loadTasks, 30000);
    </script>
</body>
</html>
